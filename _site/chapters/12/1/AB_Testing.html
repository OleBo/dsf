<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>A/B Testing</title>
  <meta name="description" content="A/B TestingIn modern data analytics, deciding whether two numerical samples come from the same underlying distribution is called A/B testing. The name refers...">

  <link rel="canonical" href="https://olebo.github.io/dsf/chapters/12/1/AB_Testing.html">
  <link rel="alternate" type="application/rss+xml" title="" href="https://olebo.github.io/dsf/feed.xml">

  <meta property="og:url"         content="https://olebo.github.io/dsf/chapters/12/1/AB_Testing.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="A/B Testing" />
<meta property="og:description" content="A/B TestingIn modern data analytics, deciding whether two numerical samples come from the same underlying distribution is called A/B testing. The name refers..." />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "https://olebo.github.io/dsf/chapters/12/1/AB_Testing.html",
  "headline":
    "A/B Testing",
  "datePublished":
    "2019-02-10T19:20:55+01:00",
  "dateModified":
    "2019-02-10T19:20:55+01:00",
  "description":
    "A/B TestingIn modern data analytics, deciding whether two numerical samples come from the same underlying distribution is called A/B testing. The name refers...",
  "author": {
    "@type": "Person",
    "name": "Berkeley DSEP"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://olebo.github.io/dsf",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://olebo.github.io/dsf",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/dsf/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/dsf/favicon.png">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/dsf';
  </script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/dsf/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


  <!-- Google analytics -->
  <script src="/dsf/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/dsf/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('.input_area pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.querySelector(`pre#${id} + a`) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>
  
  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id}`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area div.highlight').forEach(function (item, index) {
    if (!item.parentElement.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    item.insertAdjacentHTML('afterend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/dsf/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/dsf/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/dsf/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  
<script>
/**
  * To auto-embed hub URLs in interact links if given in a RESTful fashion
 */

function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}
    
function dict2param(dict) {
    params = Object.keys(dict).map(function(k) {
        return encodeURIComponent(k) + '=' + encodeURIComponent(dict[k])
    });
    return params.join('&')
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return dict2param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = document.querySelectorAll("a").forEach(function(link) {
    var href = link.href;
    // If the link is an internal link...
    if (href.search("https://olebo.github.io") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['jupyterhub'] = hub;
      } else {
        // Create the REST params
        params = {'jupyterhub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + dict2param(params);
      link.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}


// Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    jupyterHubUrl = rest['jupyterhub'];
    var hubType = null;
    var hubUrl = null;
    if (jupyterHubUrl !== undefined) {
      hubType = 'jupyterhub';
      hubUrl = jupyterHubUrl;
    }

    if (hubType !== null) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);

      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      var interactButtons = document.querySelectorAll("button.interact-button")
      var lastButton = interactButtons[interactButtons.length-1];
      var link = lastButton.parentElement;

      // If we've already run this, skip the link updating
      if (link.nextElementSibling !== null) {
        return;
      }

      // Update the link and add context div
      var href = link.getAttribute('href');
      if (lastButton.id === 'interact-button-binder') {
        // If binder links exist, we need to re-work them for jupyterhub
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // If localhost, assume we're working from a local Jupyter server and remove `/hub`
          first = [hubUrl, 'git-sync'].join('/')
        } else {
          first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
        }
        href = first + '?' + binder2Jupyterhub(href);
      } else {
        // If interact button isn't binderhub, assume it's jupyterhub
        // If JupyterHub links, we only need to replace the hub url
        href = href.replace("", hubUrl);
        if (hubUrl.indexOf('http%3A%2F%2Flocalhost') > -1) {
          // Assume we're working from a local Jupyter server and remove `/hub`
          href = href.replace("/hub/user-redirect", "");
        }
      }
      link.setAttribute('href', decodeURIComponent(href));

      // Add text after interact link saying where we're launching
      hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
      link.insertAdjacentHTML('afterend', '<div class="interact-context">on ' + hubUrlNoHttp + '</div>');

      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

runWhenDOMLoaded(updateInteractLink)
document.addEventListener('turbolinks:load', updateInteractLink)
</script>

</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <img src="/dsf/favicon.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/>
  <h2 class="c-sidebar__title"></h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/intro"
        >
          
          Introduction
        </a>

        
      </li>

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/01/what-is-data-science"
        >
          
            1.
          
          Data Science
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/01/1/intro"
                >
                  
                    1.1
                  
                  Introduction
                </a>

                
                
                  
                  
    
                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/dsf/chapters/01/1/1/computational-tools"
                    >
                      
                        1.1.1
                        
                      
                      Computational Tools
                    </a>
                
                  
                  
    
                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/dsf/chapters/01/1/2/statistical-techniques"
                    >
                      
                        1.1.2
                        
                      
                      Statistical Techniques
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/01/2/why-data-science"
                >
                  
                    1.2
                  
                  Why Data Science?
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/01/3/Plotting_the_Classics"
                >
                  
                    1.3
                  
                  Plotting the Classics
                </a>

                
                
                  
                  
    
                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/dsf/chapters/01/3/1/Literary_Characters"
                    >
                      
                        1.3.1
                        
                      
                      Literary Characters
                    </a>
                
                  
                  
    
                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/dsf/chapters/01/3/2/Another_Kind_Of_Character"
                    >
                      
                        1.3.2
                        
                      
                      Another Kind of Character
                    </a>
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/02/causality-and-experiments"
        >
          
            2.
          
          Causality and Experiments
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/02/1/observation-and-visualization-john-snow-and-the-broad-street-pump"
                >
                  
                    2.1
                  
                  John Snow and the Broad Street Pump
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/02/2/snow-s-grand-experiment"
                >
                  
                    2.2
                  
                  Snow’s “Grand Experiment”
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/02/3/establishing-causality"
                >
                  
                    2.3
                  
                  Establishing Causality
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/02/4/randomization"
                >
                  
                    2.4
                  
                  Randomization
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/02/5/endnote"
                >
                  
                    2.5
                  
                  Endnote
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/03/programming-in-python"
        >
          
            3.
          
          Programming in Python
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/03/1/Expressions"
                >
                  
                    3.1
                  
                  Expressions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/03/2/Names"
                >
                  
                    3.2
                  
                  Names
                </a>

                
                
                  
                  
    
                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/dsf/chapters/03/2/1/Growth"
                    >
                      
                        3.2.1
                        
                      
                      Example: Growth Rates
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/03/3/Calls"
                >
                  
                    3.3
                  
                  Call Expressions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/03/4/Introduction_to_Tables"
                >
                  
                    3.4
                  
                  Introduction to Tables
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/04/Data_Types"
        >
          
            4.
          
          Data Types
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/04/1/Numbers"
                >
                  
                    4.1
                  
                  Numbers
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/04/2/Strings"
                >
                  
                    4.2
                  
                  Strings
                </a>

                
                
                  
                  
    
                  <li class="c-sidebar__subsection">
                    <a class="c-sidebar__entry "
                      href="/dsf/chapters/04/2/1/String_Methods"
                    >
                      
                        4.2.1
                        
                      
                      String Methods
                    </a>
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/04/3/Comparison"
                >
                  
                    4.3
                  
                  Comparisons
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/05/Sequences"
        >
          
            5.
          
          Sequences
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/05/1/Arrays"
                >
                  
                    5.1
                  
                  Arrays
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/05/2/Ranges"
                >
                  
                    5.2
                  
                  Ranges
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/05/3/More_on_Arrays"
                >
                  
                    5.3
                  
                  More on Arrays
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/06/Tables"
        >
          
            6.
          
          Tables
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/06/1/Sorting_Rows"
                >
                  
                    6.1
                  
                  Sorting Rows
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/06/2/Selecting_Rows"
                >
                  
                    6.2
                  
                  Selecting Rows
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/06/3/Example_Trends_in_the_Population_of_the_United_States"
                >
                  
                    6.3
                  
                  Example: Population Trends
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/06/4/Example_Gender_Ratio_in_the_US_Population"
                >
                  
                    6.4
                  
                  Example: Trends in Gender
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/07/Visualization"
        >
          
            7.
          
          Visualization
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/07/1/Visualizing_Categorical_Distributions"
                >
                  
                    7.1
                  
                  Categorical Distributions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/07/2/Visualizing_Numerical_Distributions"
                >
                  
                    7.2
                  
                  Numerical Distributions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/07/3/Overlaid_Graphs"
                >
                  
                    7.3
                  
                  Overlaid Graphs
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/08/Functions_and_Tables"
        >
          
            8.
          
          Functions and Tables
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/08/1/Applying_a_Function_to_a_Column"
                >
                  
                    8.1
                  
                  Applying Functions to Columns
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/08/2/Classifying_by_One_Variable"
                >
                  
                    8.2
                  
                  Classifying by One Variable
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/08/3/Cross-Classifying_by_More_than_One_Variable"
                >
                  
                    8.3
                  
                  Cross-Classifying
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/08/4/Joining_Tables_by_Columns"
                >
                  
                    8.4
                  
                  Joining Tables by Columns
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/08/5/Bike_Sharing_in_the_Bay_Area"
                >
                  
                    8.5
                  
                  Bike Sharing in the Bay Area
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/09/Randomness"
        >
          
            9.
          
          Randomness
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/09/1/Conditional_Statements"
                >
                  
                    9.1
                  
                  Conditional Statements
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/09/2/Iteration"
                >
                  
                    9.2
                  
                  Iteration
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/09/3/Simulation"
                >
                  
                    9.3
                  
                  Simulation
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/09/4/Monty_Hall_Problem"
                >
                  
                    9.4
                  
                  The Monty Hall Problem
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/09/5/Finding_Probabilities"
                >
                  
                    9.5
                  
                  Finding Probabilities
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/10/Sampling_and_Empirical_Distributions"
        >
          
            10.
          
          Sampling and Empirical Distributions
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/10/1/Empirical_Distributions"
                >
                  
                    10.1
                  
                  Empirical Distributions
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/10/2/Sampling_from_a_Population"
                >
                  
                    10.2
                  
                  Sampling from a Population
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/10/3/Empirical_Distribution_of_a_Statistic"
                >
                  
                    10.3
                  
                  Empirical Distibution of a Statistic
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/11/Testing_Hypotheses"
        >
          
            11.
          
          Testing Hypotheses
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/11/1/Assessing_Models"
                >
                  
                    11.1
                  
                  Assessing Models
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/11/2/Multiple_Categories"
                >
                  
                    11.2
                  
                  Multiple Categories
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/11/3/Decisions_and_Uncertainty"
                >
                  
                    11.3
                  
                  Decisions and Uncertainty
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/12/Comparing_Two_Samples"
        >
          
            12.
          
          Comparing Two Samples
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/dsf/chapters/12/1/AB_Testing"
                >
                  
                    12.1
                  
                  A/B Testing
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/12/2/Deflategate"
                >
                  
                    12.2
                  
                  Deflategate
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/12/3/Causality"
                >
                  
                    12.3
                  
                  Causality
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/13/Estimation"
        >
          
            13.
          
          Estimation
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/13/1/Percentiles"
                >
                  
                    13.1
                  
                  Percentiles
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/13/2/Bootstrap"
                >
                  
                    13.2
                  
                  The Bootstrap
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/13/3/Confidence_Intervals"
                >
                  
                    13.3
                  
                  Confidence Intervals
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/13/4/Using_Confidence_Intervals"
                >
                  
                    13.4
                  
                  Using Confidence Intervals
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/14/Why_the_Mean_Matters"
        >
          
            14.
          
          Why the Mean Matters
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/14/1/Properties_of_the_Mean"
                >
                  
                    14.1
                  
                  Properties of the Mean
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/14/2/Variability"
                >
                  
                    14.2
                  
                  Variability
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/14/3/SD_and_the_Normal_Curve"
                >
                  
                    14.3
                  
                  The SD and the Normal Curve
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/14/4/Central_Limit_Theorem"
                >
                  
                    14.4
                  
                  The Central Limit Theorem
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/14/5/Variability_of_the_Sample_Mean"
                >
                  
                    14.5
                  
                  The Variability of the Sample Mean
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/14/6/Choosing_a_Sample_Size"
                >
                  
                    14.6
                  
                  Choosing a Sample Size
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/15/Prediction"
        >
          
            15.
          
          Prediction
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/15/1/Correlation"
                >
                  
                    15.1
                  
                  Correlation
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/15/2/Regression_Line"
                >
                  
                    15.2
                  
                  The Regression Line
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/15/3/Method_of_Least_Squares"
                >
                  
                    15.3
                  
                  The Method of Least Squares
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/15/4/Least_Squares_Regression"
                >
                  
                    15.4
                  
                  Least Squares Regression
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/15/5/Visual_Diagnostics"
                >
                  
                    15.5
                  
                  Visual Diagnostics
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/15/6/Numerical_Diagnostics"
                >
                  
                    15.6
                  
                  Numerical Diagnostics
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/16/Inference_for_Regression"
        >
          
            16.
          
          Inference for Regression
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/16/1/Regression_Model"
                >
                  
                    16.1
                  
                  A Regression Model
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/16/2/Inference_for_the_True_Slope"
                >
                  
                    16.2
                  
                  Inference for the True Slope
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/16/3/Prediction_Intervals"
                >
                  
                    16.3
                  
                  Prediction Intervals
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/17/Classification"
        >
          
            17.
          
          Classification
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/17/1/Nearest_Neighbors"
                >
                  
                    17.1
                  
                  Nearest Neighbors
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/17/2/Training_and_Testing"
                >
                  
                    17.2
                  
                  Training and Testing
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/17/3/Rows_of_Tables"
                >
                  
                    17.3
                  
                  Rows of Tables
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/17/4/Implementing_the_Classifier"
                >
                  
                    17.4
                  
                  Implementing the Classifier
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/17/5/Accuracy_of_the_Classifier"
                >
                  
                    17.5
                  
                  The Accuracy of the Classifier
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/17/6/Multiple_Regression"
                >
                  
                    17.6
                  
                  Multiple Regression
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/dsf/chapters/18/Updating_Predictions"
        >
          
            18.
          
          Updating Predictions
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections u-hidden-visually">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/18/1/More_Likely_than_Not_Binary_Classifier"
                >
                  
                    18.1
                  
                  A "More Likely Than Not" Binary Classifier
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/dsf/chapters/18/2/Making_Decisions"
                >
                  
                    18.2
                  
                  Making Decisions
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://github.com/choldgraf/jupyter-book">Jupyter Book</a></p>
</nav>

      <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#ab-testing">A/B Testing</a></li>
  <li><a href="#smokers-and-nonsmokers">Smokers and Nonsmokers</a></li>
  <li><a href="#the-hypotheses">The Hypotheses</a></li>
  <li><a href="#test-statistic">Test Statistic</a></li>
  <li><a href="#predicting-the-statistic-under-the-null-hypothesis">Predicting the Statistic Under the Null Hypothesis</a></li>
  <li><a href="#permutation-test">Permutation Test</a></li>
  <li><a href="#conclusion-of-the-test">Conclusion of the Test</a></li>
  <li><a href="#a-function-to-simulate-the-differences-under-the-null-hypothesis">A Function to Simulate the Differences Under the Null Hypothesis</a></li>
</ul>
    </nav>
  </aside>



      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            
<div class="buttons">








<a href="https://mybinder.org/v2/gh/olebo/dsf/gh-pages?filepath=content%2Fchapters%2F12%2F1%2FAB_Testing.ipynb"><button class="interact-button" id="interact-button-binder"><img class="interact-button-logo" src="/dsf/assets/images/logo_binder.svg" alt="Interact" />Interact</button></a>


</div>


            <div class="c-textbook__content">
              <h3 id="ab-testing">A/B Testing</h3>
<p>In modern data analytics, deciding whether two numerical samples come from the same underlying distribution is called <em>A/B testing</em>. The name refers to the labels of the two samples, A and B.</p>

<p>We will develop the method in the context of an example. The data come from a sample of newborns in a large hospital system. We will treat it as if it were a simple random sample though the sampling was done in multiple stages. <a href="https://www.stat.berkeley.edu/~statlabs/">Stat Labs</a> by Deborah Nolan and Terry Speed has details about a larger dataset from which this set is drawn.</p>

<h3 id="smokers-and-nonsmokers">Smokers and Nonsmokers</h3>
<p>The table <code class="highlighter-rouge">baby</code> contains the following variables for 1,174 mother-baby pairs: the baby’s birth weight in ounces, the number of gestational days, the mother’s age in completed years, the mother’s height in inches, pregnancy weight in pounds, and whether or not the mother smoked during pregnancy.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">baby</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="s">'baby.csv'</span><span class="p">)</span>
<span class="n">baby</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Birth Weight</th> <th>Gestational Days</th> <th>Maternal Age</th> <th>Maternal Height</th> <th>Maternal Pregnancy Weight</th> <th>Maternal Smoker</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>120         </td> <td>284             </td> <td>27          </td> <td>62             </td> <td>100                      </td> <td>False          </td>
        </tr>
        <tr>
            <td>113         </td> <td>282             </td> <td>33          </td> <td>64             </td> <td>135                      </td> <td>False          </td>
        </tr>
        <tr>
            <td>128         </td> <td>279             </td> <td>28          </td> <td>64             </td> <td>115                      </td> <td>True           </td>
        </tr>
        <tr>
            <td>108         </td> <td>282             </td> <td>23          </td> <td>67             </td> <td>125                      </td> <td>True           </td>
        </tr>
        <tr>
            <td>136         </td> <td>286             </td> <td>25          </td> <td>62             </td> <td>93                       </td> <td>False          </td>
        </tr>
        <tr>
            <td>138         </td> <td>244             </td> <td>33          </td> <td>62             </td> <td>178                      </td> <td>False          </td>
        </tr>
        <tr>
            <td>132         </td> <td>245             </td> <td>23          </td> <td>65             </td> <td>140                      </td> <td>False          </td>
        </tr>
        <tr>
            <td>120         </td> <td>289             </td> <td>25          </td> <td>62             </td> <td>125                      </td> <td>False          </td>
        </tr>
        <tr>
            <td>143         </td> <td>299             </td> <td>30          </td> <td>66             </td> <td>136                      </td> <td>True           </td>
        </tr>
        <tr>
            <td>140         </td> <td>351             </td> <td>27          </td> <td>68             </td> <td>120                      </td> <td>False          </td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p>
</div>

<p>One of the aims of the study was to see whether maternal smoking was associated with birth weight. Let’s see what we can say about the two variables.</p>

<p>We’ll start by selecting just <code class="highlighter-rouge">Birth Weight</code> and <code class="highlighter-rouge">Maternal Smoker</code>. There are 715 non-smokers among the women in the sample, and 459 smokers.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smoking_and_birthweight</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="s">'Birth Weight'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">)</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Maternal Smoker</th> <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False          </td> <td>715  </td>
        </tr>
        <tr>
            <td>True           </td> <td>459  </td>
        </tr>
    </tbody>
</table>
</div>

<p>Let’s look at the distribution of the birth weights of the babies of the non-smoking mothers compared to those of the smoking mothers. To generate two overlaid histograms, we will use <code class="highlighter-rouge">hist</code> with the optional <code class="highlighter-rouge">group</code> argument which is a column label or index. The rows of the table are first grouped by this column and then a histogram is drawn for each one.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s">'Birth Weight'</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="s">'Maternal Smoker'</span><span class="p">)</span>
</code></pre></div></div>

<p class="output output_png"><img src="../../../images/chapters/12/1/AB_Testing_8_0.png" alt="png" /></p>

<p>The distribution of the weights of the babies born to mothers who smoked appears to be shifted slightly to the left of the distribution corresponding to non-smoking mothers. The weights of the babies of the mothers who smoked seem lower, on average than the weights of the babies of the non-smokers.</p>

<p>This raises the question of whether the difference reflects just chance variation or a difference in the distributions in the larger population. Could it be that there is no difference between the two distributions in the population, but we are seeing a difference in the samples just because of the mothers who happened to be selected?</p>

<h3 id="the-hypotheses">The Hypotheses</h3>
<p>We can try to answer this question by a test of hypotheses. The chance model that we will test says that there is no underlying difference; the distributions in the samples are different just due to chance. Formally, this is the null hypothesis.</p>

<p><strong>Null hypothesis:</strong> In the population, the distribution of birth weights of babies is the same for mothers who don’t smoke as for mothers who do. The difference in the sample is due to chance.</p>

<p><strong>Alternative hypothesis:</strong> In the population, the babies of the mothers who smoke have a lower birth weight, on average, than the babies of the non-smokers.</p>

<h3 id="test-statistic">Test Statistic</h3>
<p>The alternative hypothesis compares the average birth weights of the two groups and says that the average for the mothers who smoke is smaller. Therefore it is reasonable for us to use the difference between the two group means as our statistic.</p>

<p>We will do the subtraction in the order “average weight of the smoking group $-$ average weight of the non-smoking group”. Small values (that is, large negative values) of this statistic will favor the alternative hypothesis.</p>

<p>The observed value of the test statistic is about $-9.27$ ounces.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">means_table</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span>
<span class="n">means_table</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Maternal Smoker</th> <th>Birth Weight average</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False          </td> <td>123.085             </td>
        </tr>
        <tr>
            <td>True           </td> <td>113.819             </td>
        </tr>
    </tbody>
</table>
</div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">means</span> <span class="o">=</span> <span class="n">means_table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">observed_difference</span> <span class="o">=</span> <span class="n">means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">observed_difference</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-9.266142572024918
</code></pre></div></div>

<h3 id="predicting-the-statistic-under-the-null-hypothesis">Predicting the Statistic Under the Null Hypothesis</h3>

<p>To see how the statistic should vary under the null hypothesis, we have to figure out how to simulate the statistic under that hypothesis. A clever method based on <em>random permutations</em> does just that.</p>

<p>If there were no difference between the two distributions in the underlying population, then whether a birth weight has the label <code class="highlighter-rouge">True</code> or <code class="highlighter-rouge">False</code> with respect to maternal smoking should make no difference to the average. The idea, then, is to shuffle all the birth weights randomly among the mothers. This is called <em>random permutation</em>.</p>

<p>Take the difference of the two new group means: the mean of the shuffled weights assigned to the smokers and the mean of the shuffled weights assigned to the non-smokers. This is a simulated value of the test statistic under the null hypothesis.</p>

<p>Let’s see how to do this. It’s always a good idea to start with the data.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smoking_and_birthweight</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Maternal Smoker</th> <th>Birth Weight</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False          </td> <td>120         </td>
        </tr>
        <tr>
            <td>False          </td> <td>113         </td>
        </tr>
        <tr>
            <td>True           </td> <td>128         </td>
        </tr>
        <tr>
            <td>True           </td> <td>108         </td>
        </tr>
        <tr>
            <td>False          </td> <td>136         </td>
        </tr>
        <tr>
            <td>False          </td> <td>138         </td>
        </tr>
        <tr>
            <td>False          </td> <td>132         </td>
        </tr>
        <tr>
            <td>False          </td> <td>120         </td>
        </tr>
        <tr>
            <td>True           </td> <td>143         </td>
        </tr>
        <tr>
            <td>False          </td> <td>140         </td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p>
</div>

<p>There are 1,174 rows in the table. To shuffle all the birthweights, we will draw a random sample of 1,174 rows without replacement. Then the sample will include all the rows of the table, in random order.</p>

<p>We can use the Table method <code class="highlighter-rouge">sample</code> with the optional <code class="highlighter-rouge">with_replacement=False</code> argument. We don’t have to specify a sample size, because by default, <code class="highlighter-rouge">sample</code> draws as many times as there are rows in the table.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shuffled_weights</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">with_replacement</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">original_and_shuffled</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Shuffled Birth Weight'</span><span class="p">,</span> <span class="n">shuffled_weights</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">original_and_shuffled</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Maternal Smoker</th> <th>Birth Weight</th> <th>Shuffled Birth Weight</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False          </td> <td>120         </td> <td>94                   </td>
        </tr>
        <tr>
            <td>False          </td> <td>113         </td> <td>96                   </td>
        </tr>
        <tr>
            <td>True           </td> <td>128         </td> <td>102                  </td>
        </tr>
        <tr>
            <td>True           </td> <td>108         </td> <td>101                  </td>
        </tr>
        <tr>
            <td>False          </td> <td>136         </td> <td>55                   </td>
        </tr>
        <tr>
            <td>False          </td> <td>138         </td> <td>122                  </td>
        </tr>
        <tr>
            <td>False          </td> <td>132         </td> <td>116                  </td>
        </tr>
        <tr>
            <td>False          </td> <td>120         </td> <td>163                  </td>
        </tr>
        <tr>
            <td>True           </td> <td>143         </td> <td>110                  </td>
        </tr>
        <tr>
            <td>False          </td> <td>140         </td> <td>137                  </td>
        </tr>
    </tbody>
</table>
<p>... (1164 rows omitted)</p>
</div>

<p>Each mother now has a random birth weight assigned to her. If the null hypothesis is true, all these random arrangements should be equally likely.</p>

<p>Let’s see how different the average weights are in the two randomly selected groups.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">all_group_means</span> <span class="o">=</span> <span class="n">original_and_shuffled</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span>
<span class="n">all_group_means</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Maternal Smoker</th> <th>Birth Weight average</th> <th>Shuffled Birth Weight average</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False          </td> <td>123.085             </td> <td>118.91                       </td>
        </tr>
        <tr>
            <td>True           </td> <td>113.819             </td> <td>120.322                      </td>
        </tr>
    </tbody>
</table>
</div>

<p>The averages of the two randomly selected groups are quite a bit closer than the averages of the two original groups.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shuffled_means</span> <span class="o">=</span> <span class="n">original_and_shuffled</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">difference</span> <span class="o">=</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">difference</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1.4119505766564515
</code></pre></div></div>

<p>But could a different shuffle have resulted in a larger difference between the group averages? To get a sense of the variability, we must simulate the difference many times.</p>

<p>Let’s collect all the code that we need for simulating one value of the difference between averages, under the null hypothesis. Notice that because we are using the same label each time for the column of shuffled weights, the existing column just gets overwritten by the newly generated one. This works well for us because we don’t need to save all the shuffled values. We just need to save the value of the statistic.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Generate one value of the test statistic under the null hypothesis</span>

<span class="c"># Shuffle all the weights and assign the shuffled weights to the two groups of mothers</span>
<span class="n">shuffled_weights</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">with_replacement</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">original_and_shuffled</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Shuffled Birth Weight'</span><span class="p">,</span> <span class="n">shuffled_weights</span><span class="p">)</span>

<span class="c"># Find the difference between the means of two randomly assigned groups</span>
<span class="n">shuffled_means</span> <span class="o">=</span> <span class="n">original_and_shuffled</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">difference</span> <span class="o">=</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">difference</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-0.48756951109892555
</code></pre></div></div>

<h3 id="permutation-test">Permutation Test</h3>
<p>Tests based on random permutations of the data are called <em>permutation tests</em>. We are performing one in this example. In the cell below, we will simulate our test statistic – the difference between the averages of the two groups – many times and collect the differences in an array. The code in the body of the for loop is just copied over from the cell above.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">differences</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>

<span class="n">repetitions</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
    
    <span class="n">shuffled_weights</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">with_replacement</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">original_and_shuffled</span> <span class="o">=</span> <span class="n">smoking_and_birthweight</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Shuffled Birth Weight'</span><span class="p">,</span> <span class="n">shuffled_weights</span><span class="p">)</span>

    <span class="n">shuffled_means</span> <span class="o">=</span> <span class="n">original_and_shuffled</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">simulated_difference</span> <span class="o">=</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">differences</span><span class="p">,</span> <span class="n">simulated_difference</span><span class="p">)</span>
    
</code></pre></div></div>

<p>The array <code class="highlighter-rouge">differences</code> contains 5,000 simulated values of our test statistic – the difference between the mean weight in the smoking group and the mean weight in the non-smoking group.</p>

<h3 id="conclusion-of-the-test">Conclusion of the Test</h3>
<p>The histogram below shows the distribution of these 5,000 values. It is the empirical distribution of the test statistic simulated under the null hypothesis. It is a prediction made by the null hypothesis, about the statistic.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Difference Between Group Averages'</span><span class="p">,</span> <span class="n">differences</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Observed Difference:'</span><span class="p">,</span> <span class="n">observed_difference</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Prediction Under the Null Hypothesis'</span><span class="p">);</span>
</code></pre></div></div>

<div class="output output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Observed Difference: -9.266142572024918

</code></pre></div></div>

<p class="output output_png"><img src="../../../images/chapters/12/1/AB_Testing_28_1.png" alt="png" /></p>

<p>Notice how the distribution is centered around 0. This makes sense, because under the null hypothesis the two groups should have roughly the same average. Therefore the difference between the group averages should be around 0.</p>

<p>The observed difference in the original sample is about $-9.27$ ounces, which doesn’t even appear on the horizontal scale of the histogram. The observed value of the statistic and the predicted behavior of the statistic under the null hypothesis are inconsistent.</p>

<p>The conclusion of the test is that the data support the alternative more than they support the null. The average birth weight of babies born to mothers who smoke is less than the average birth weight of babies born to non-smokers.</p>

<p>If you want to compute an empirical P-value, remember that low values of the statistic favor the alternative hypothesis.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">empirical_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">differences</span> <span class="o">&lt;=</span> <span class="n">observed_difference</span><span class="p">)</span> <span class="o">/</span> <span class="n">repetitions</span>
<span class="n">empirical_P</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.0
</code></pre></div></div>

<p>The empirical P-value is 0, meaning that none of the 5,000 observed samples resulted in a difference of -9.27 or lower. This is an approximation; the exact chance of getting a difference in that range is not 0 but it is vanishingly small.</p>

<h3 id="a-function-to-simulate-the-differences-under-the-null-hypothesis">A Function to Simulate the Differences Under the Null Hypothesis</h3>
<p>We will want to perform permutation tests for the difference between averages in other contexts as well. Let us define a function that generates the array of simulated differences, based on the code that we wrote above. That will save us time later.</p>

<p>The function <code class="highlighter-rouge">difference_of_permuted_sample_means</code> takes four arguments:</p>
<ul>
  <li>the name of the data table</li>
  <li>the label of the column containing the variable whose average is of interest</li>
  <li>the label of the column of group labels</li>
  <li>the number of repetitions</li>
</ul>

<p>It returns and array of simulated differences in group means, each computed by first randomly permuting the data and assigning random values to each group. The length of the array is equal to the number of repetitions.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">permuted_sample_average_difference</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">group_label</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">):</span>
    
    <span class="n">tbl</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">group_label</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    
    <span class="n">differences</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
        <span class="n">shuffled</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">with_replacement</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">original_and_shuffled</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Shuffled Data'</span><span class="p">,</span> <span class="n">shuffled</span><span class="p">)</span>

        <span class="n">shuffled_means</span> <span class="o">=</span> <span class="n">original_and_shuffled</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">group_label</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">simulated_difference</span> <span class="o">=</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">shuffled_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
        <span class="n">differences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">differences</span><span class="p">,</span> <span class="n">simulated_difference</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">differences</span>   
</code></pre></div></div>

<p>As an example of the use of this function, we will test whether there was any difference in the ages of the smoking and non-smoking mothers. The histograms of the two distributions in the sample are a little different. The smokers seem a little younger on average.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smoking_and_age</span> <span class="o">=</span> <span class="n">baby</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="s">'Maternal Age'</span><span class="p">)</span>
<span class="n">smoking_and_age</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s">'Maternal Age'</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="s">'Maternal Smoker'</span><span class="p">)</span>
</code></pre></div></div>

<p class="output output_png"><img src="../../../images/chapters/12/1/AB_Testing_35_0.png" alt="png" /></p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">smoking_and_age</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span>
</code></pre></div></div>

<div class="output output_html">
<table border="1" class="dataframe">
    <thead>
        <tr>
            <th>Maternal Smoker</th> <th>Maternal Age average</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>False          </td> <td>27.5441             </td>
        </tr>
        <tr>
            <td>True           </td> <td>26.7364             </td>
        </tr>
    </tbody>
</table>
</div>

<p>The observed difference between the average ages is about $-0.8$ years.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">observed_means</span> <span class="o">=</span> <span class="n">smoking_and_age</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">observed_difference</span> <span class="o">=</span> <span class="n">observed_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">observed_means</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">observed_difference</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-0.8076725017901509
</code></pre></div></div>

<p>If the underlying distributions of ages in the two groups are the same, then the empirical distribution of the difference based on permuted samples will predict how the statistic will vary due to chance.</p>

<p>We can generate such differences using the function we just defined.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">differences</span> <span class="o">=</span> <span class="n">permuted_sample_average_difference</span><span class="p">(</span><span class="n">baby</span><span class="p">,</span> <span class="s">'Maternal Age'</span><span class="p">,</span> <span class="s">'Maternal Smoker'</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
</code></pre></div></div>

<p>The observed difference is in the tail of the empirical distribution of the differences simulated under the null hypothesis.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s">'Difference Between Group Averages'</span><span class="p">,</span> <span class="n">differences</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plots</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">observed_difference</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Prediction Under the Null Hypothesis'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Observed Difference:'</span><span class="p">,</span> <span class="n">observed_difference</span><span class="p">)</span>
</code></pre></div></div>

<div class="output output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Observed Difference: -0.8076725017901509

</code></pre></div></div>

<p class="output output_png"><img src="../../../images/chapters/12/1/AB_Testing_42_1.png" alt="png" /></p>

<p>The empirical P-value of the test is the proportion of simulated differences that were equal to or less than the observed difference. This is because low values of the difference favor the alternative hypothesis that the smokers were younger on average.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">empirical_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">differences</span> <span class="o">&lt;=</span> <span class="n">observed_difference</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5000</span>
<span class="n">empirical_P</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.01
</code></pre></div></div>

<p>The empirical P-value is just over 1%, which is less than 5% and therefore the result is statistically significant. The test supports the hypothesis that the smokers were younger on average.</p>

              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/dsf/chapters/12/Comparing_Two_Samples">
      〈 <span class="u-margin-right-tiny"></span> Comparing Two Samples
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/dsf/chapters/12/2/Deflategate">
      Deflategate <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>
